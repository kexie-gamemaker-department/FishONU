# History Line

主要想记录一下这次马拉松的结果，虽然一开始没打算马拉松的，但是突然间感觉专注感上来了就当马拉松挑战了。出去外面散步的时候突发奇想想要写一个联机棋牌游戏，以锻炼我的Unity和C#技能，毕竟到目前为止我都没写过多少完整的游戏，甚至连技术演示demo都不超过5个。

没有规则的马拉松，不过我到希望赶紧做完初版，一是我想看这样一个项目大概需要多长时间，二是我想看这个项目我第一口气能坚持多久。

## 26.2.6

4h16m23s

从下午有 idea 开始就直接动手弄到了凌晨 12 点。

创建项目，添加一些依赖，然后从 CardInfo（现在的 CardData）开始写。



## 26.2.7

8h49m18s

有点爽，虽然代码在野蛮生长。

不想用 gitmoji 了，每次都要翻怪累的。

实现了 OwnerInventory SecretInventory BaseInventory IArrangeStrategy等卡牌相关的类，还有 DebugUI，以及一些动画。最后心满意足地写了状态机的框架就收工了。



## 26.2.8

10h21m24s

大体上按顺序：实现了弃牌堆Prefab，完善了 DebugUI，然后实现了数据遮掩（客户端看不到其他人的牌实际数据，只能看到卡的数量），又实现了手牌的ArrangeStrategy。

最后一部分写得很折磨，因为状态不好还硬写，写到了 1点23，低级 bug 频出不穷，后悔了。



## 26.2.9

12h10m45s

不知不觉又写一天。

修了一些昨天加班以及先前野蛮生长导致的问题，差不多一整天都在重构以及写一些辅助类，虽然没睡好，但是刚好写得东西难度不高，后面不用重做。但还是侥幸，下不为例。



## 26.2.10

7h41m16s

因为要忙别的事情了，加上有些身心俱疲，没得空写太多，不过还是写了一个大功能，然后整理和重写了一下状态机。

修了昨天没得空修的 ArrangeStrategy 的 bug，然后写完了游戏的准备阶段（也就是开局洗牌发牌）



## 26.2.11

6h33m31s

没想到还是挺忙的，结果又没得写多少。

今天搓了个简单的 UI 然后实现了选卡打出的功能，然后给 OwnerInventory 加了高光卡片的功能，再稍微重构了一下 PlayerController GameManager GameUI 几个类之间的接口和连接关系，以及给 CardData 重载了 Equals 来适应网络的卡片比较（比 guid 和卡片内容而不是类型引用，因为类型引用在序列化网络传输后会乱），还加了个显示当前轮到谁打牌的功能。

最后开始写 History Line 了，截止目前在 wakatime 上能看到项目已经持续了 49h37m 了，因为用了 ParrelSync 所以可能有点偏差，不过误差不超过 20m 吧。



## 26.2.12

7h3m14s / 56h40m14s

到 waktime 的免费计划计时边界了，所以现在要手动累加时间了。希望我不会抄错。

今天提交和PR的碎度很高，创建PR的速度也变快了，可能是因为现在框架起来一半之后，越来越接近能够辨认哪些是小功能而分开进行提交和PR了，而不是像之前因为分开之后功能不完全PR进main也没用。（或者换句话说，PR 对main更加有意义了，标题也好写）。所以今天交了 16 个 commit，虽然我才写了 7h，相当夸张。而项目的总 commit 也来到了 76 commits.

当然也可能是因为今天主要在修 bug 和重构导致的，一边修 bug 一边根据现在的框架重写重构一些之前写的功能。而主要功能就新实现了功能牌实现功能的架构，然后写了很简单的反转牌和跳过牌（因为之前写状态机的时候稍微顺手留过一手），不过即便到这样了也还是被架构肘击了一下，被简单的 bug 硬控了几个钟。不过我感觉也不是什么大问题，虽然写得少了，但是起码有写新功能。

今天选择修 bug 是因为早上写了会感觉就没在状态所以就打算写简单的然后修 bug差不多了，而另外还有一个原因则是昨天晚上梳理的时候 AI 说开发遵循了敏捷开发，结果我回去又看了眼敏捷开发和极限开发的要点，上头了。今天早上起来反而感觉有点束手束脚或者说邯郸学步了，老是会去在意开发计划以及是否有高效率。所以我决定今天调整一天，放放松，顺便慢慢让专注力回归开发活动本身而不是未来计划。

总而言之，慢慢调整吧，显然现在已经过了前半程从零开始的艰难时期，可以站在地基上更轻松一些地写。而至于高不高效，可能遵循直觉的判断不去反复检查那些复杂的规则会更自然和轻松，毕竟思想从实践中来总比循规蹈矩更有印象和理解。



## 26.2.13

7h10m35s / 63h50m49s

早上修了会 bug，然后手贱更新了 Rider，结果导致 Rider 代码分析不懂为什么就没有了，浪费了两个钟，最后转而使用 VS2022 继续写。

虽然昨天尝试早睡恢复精力，但是可能是环境不好轻微失眠导致今早起来依旧没什么精力，但是眼看就要到最初预定的 15 日，所以依旧避开大幅度重构而选择实现功能和小幅度简单的重构（在 AI 和我的双重检查下进行）。

不过虽然早上和中午运气不太好遇到了很多麻烦和其他事情干扰，下午也依旧不顺利。下午基本上在顺着早上的重构琢磨如何重构状态机以更好地支持功能牌实现，前后想了应该有 2h 多才有个造型，调试修 bug 完提交又花费了 1h。不过很意外的是，在 Wild 之后的 Wild Draw Four 刚好符合我设计的架构，只需要几行就能加入并且没有问题，这让我很惊喜。

晚上则是为后面 UI 大开工做一些准备，比如说整理代码、修已知的简单 bug、增加游戏的结算机制。

按照目前的进度和状态，有些拿不准能否在 15 日结束前完成 demo 而不是只有核心，但我更多估计是不行的，因为后半程开始的状态明显下滑，心态也开始摇晃（这也是为什么调整到保持每天 6-7h 的原因），加上对 UI 不够熟悉，所以估计还剩的两天又得踩一堆坑，不然就是让代码一片混乱。

不过总的来说，在第一天17点开工到现在第七天22点，对现在除了 UI 依旧一坨但是已经可以完全玩上基础规则甚至还有几条进阶规则的项目来说，我感觉这个马拉松已经赢了七五开了，困难的地方已经过去，只差最后的临门一脚了。实在不行就算了，反正等一两周放完假继续回来做。

o7.



## 26.2.14

5h48m40s / 69h39m29s

今天就 6 个 commit，其中有意义的甚至只有 5 个。但是这不是问题，问题是节奏乱掉了。

主要昨天晚上被其他事情干扰导致很晚才睡，原本计划今天进行的冲刺不得不延后了……然后今早因为外部原因而早起又不得不开始考虑起来。

今天上午跑去看 R3 的包了，因为昨晚睡不着但是又忍住不能敲码所以尝试去找有什么好工具能帮助写 UI，所以今天早上基本上没写码，学了一下 R3 和 ReactiveX 怎么用，因为写过 React 的缘故，对这种组合响应式的模型很快就学会怎么上手了，然后光速用 R3 重写了原先的 GameUI。

而今天最大的败笔（也许是？）就是晚上，因为中午、下午和晚上几乎没有得多少空闲时间，这让我感觉后面几天都有可能会被逐渐增加的外部因素而导致项目终结，所以决定进行一次冲刺，就像因为其他原因不得不把进行75%的马拉松进行一口气冲刺到90%（如果不算玩法核心外围的各种系统的话）。在短短3h还是4h内和AI通过R3来加速开发，一口气把主界面场景、主机/加入游戏/设置名称、游戏中玩家名称显示全部写完了，我敢肯定实现方法肯定不是最好的但是有一定遵循我的架构的（唯一可能乱的只有UI类的代码，因为实现方式千变万化），其中也不乏使用了邪恶的黑魔法（比如说神秘的Observable.Interval），不过都不是问题，我把这些都看成后面如果有空才进行的善后工作。

所以总而言之，我觉得这个项目已经可以称作是v0.0.1了，剩下的就是慢慢完善UI，然后加入外围系统比如说特效、音效之类，还有更多用户友好的功能。

我觉得这次冲刺可能算败笔，也可能不算。败在进行了中低质量代码的涌入以及少部分问题的暴力修复，还有各种实现方式的混乱。而不算败笔的原因是，这次冲刺可以看成是马拉松的结束，从这次之后我就不用非得顶着马拉松的压力继续赶工，可以转而进入每天30分钟到2h这样的慢慢重构和整理期，同时慢慢加入新功能，就像那些长期更新的软件一样。

现在大概 100+ commits，Scripts 下有 2700 行 C# 代码。感觉算是目前我写过最大的项目了。

至于马拉松，我觉得已经完成了，虽然按时间间隔算已经是七天整加上一个晚上了，但是毫无疑问我现在离成品几乎只差一个变色牌变色后显示当前颜色（当时忘了给它留接口真是遗憾，不过现在添加也不难，就是设计R3 Subject和Observable然后连上UI的事情）

至此，先度假。🏖

o7.


